<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://firebase.googleapis.com; object-src 'none';"
    />
    <title>Consolidador de Pedidos</title>

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="../vendor/normalize.css" />
    <link rel="stylesheet" href="../vendor/fonts.css" />

    <!-- Project CSS -->
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/fonts.css" />
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/content.css" />
    <link rel="stylesheet" href="css/elements.css" />
    <link rel="stylesheet" href="css/feed.css" />
    <link rel="stylesheet" href="css/footer.css" />
    <link rel="stylesheet" href="css/page.css" />
    <link rel="stylesheet" href="css/popup.css" />
    <link rel="stylesheet" href="css/profile.css" />
    <link rel="stylesheet" href="css/new.css" />
  </head>
  <body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando dados...</div>
      </div>
    </div>

    <div id="app">
      <!-- Header -->
      <header class="header">
        <div class="header__container">
          <h1 class="header__title">Gerenciador de Pedidos</h1>
          <nav class="header__nav">
            <button class="header__nav-btn" data-view="dashboard">
              Dashboard
            </button>
            <button class="header__nav-btn" data-view="orders">Pedidos</button>
            <button class="header__nav-btn" data-view="import">
              Importar CSV
            </button>
            <button class="btn btn--secondary" id="auth-btn">Entrar</button>
          </nav>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="view active">
          <div class="content">
            <div
              data-view-only
              style="
                display: none;
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                color: #856404;
                padding: 12px;
                border-radius: 6px;
                margin: 10px 0;
                text-align: center;
                font-size: 14px;
              "
            >
              🔒 <strong>Modo Visualização</strong>
            </div>
            <div class="content__header">
              <h2 class="content__title">Dashboard de Lotes</h2>
              <button
                class="btn btn--primary"
                id="new-batch-btn"
                data-requires-auth
              >
                Novo Lote
              </button>
            </div>

            <!-- Status Cards -->
            <div class="status-cards">
              <div class="status-card" data-status="CRIADO">
                <h3>Criado</h3>
                <span class="status-card__count">0</span>
              </div>
              <div class="status-card" data-status="A_CAMINHO">
                <h3>A Caminho</h3>
                <span class="status-card__count">0</span>
              </div>
              <div class="status-card" data-status="RECEBIDO">
                <h3>Recebido</h3>
                <span class="status-card__count">0</span>
              </div>
              <div class="status-card" data-status="SEPARADO">
                <h3>Separado</h3>
                <span class="status-card__count">0</span>
              </div>
            </div>

            <!-- Batches Container -->
            <div class="batches-container">
              <!-- Batches Section Header -->
              <div class="batches-section-header">
                <h3 class="batches-section-title">Lotes</h3>
                <p class="batches-section-description">
                  Lotes são grupos de 5 pedidos que serão enviados todos juntos
                  para o nosso endereço de logista
                </p>
                <div class="customer-message-container">
                  <p class="customer-message-label">
                    Mensagem de envio ao cliente:
                  </p>
                  <div class="customer-message-wrapper">
                    <span
                      class="customer-message-text"
                      id="customer-message-text"
                    >
                      Seu pedido foi enviado da fábrica internacional para a
                      nossa loja em Curitiba-PR. Assim que chegar, será
                      redirecionado para sua residência. L0
                    </span>
                    <button
                      class="btn btn--small btn--secondary copy-btn"
                      id="copy-message-btn"
                      title="Copiar mensagem"
                    >
                      📋 Copiar
                    </button>
                  </div>
                </div>
              </div>

              <!-- Dashboard Search -->
              <div class="dashboard-search">
                <input
                  type="text"
                  id="dashboard-search"
                  class="input"
                  placeholder="Buscar por nome do lote ou produto..."
                />
              </div>

              <!-- Batches List -->
              <div id="batches-list" class="batches-list"></div>
            </div>

            <!-- Express Orders Section -->
            <div class="express-section">
              <div class="express-section__header">
                <h3 class="express-section__title">
                  🚀 Pedidos Expresso (Envios Rápidos)
                </h3>
                <span class="express-section__count" id="express-count">0</span>
              </div>
              <div class="express-section__description">
                <p>
                  Esses são os pedidos que serão enviados diretos para a casa do
                  cliente
                </p>
              </div>
              <div id="express-orders-list" class="express-orders-list"></div>
            </div>
          </div>
        </div>

        <!-- Orders View -->
        <div id="orders-view" class="view">
          <div class="content">
            <div
              data-view-only
              style="
                display: none;
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                color: #856404;
                padding: 12px;
                border-radius: 6px;
                margin: 10px 0;
                text-align: center;
                font-size: 14px;
              "
            >
              🔒 <strong>Modo Visualização:</strong> Faça login para criar,
              editar ou excluir dados.
            </div>
            <div class="content__header">
              <h2 class="content__title">Gerenciar Pedidos</h2>
              <button
                class="btn btn--primary"
                id="new-order-btn"
                data-requires-auth
              >
                Novo Pedido
              </button>
            </div>

            <!-- Filters -->
            <div class="filters">
              <input
                type="text"
                id="order-search"
                class="input"
                placeholder="Buscar por ID ou produto..."
              />
              <select id="shipping-filter" class="select">
                <option value="">Todos os fretes</option>
                <option value="PADRAO">Padrão</option>
                <option value="EXPRESSO">Expresso</option>
              </select>
              <select id="payment-filter" class="select">
                <option value="">Todos os status</option>
                <option value="PAGO">Pago</option>
                <option value="AGUARDANDO">Aguardando</option>
                <option value="CANCELADO">Cancelado</option>
              </select>
            </div>

            <!-- Orders List -->
            <div id="orders-list" class="orders-list"></div>
          </div>
        </div>

        <!-- Import View -->
        <div id="import-view" class="view">
          <div class="content">
            <div class="content__header">
              <h2 class="content__title">Importar CSV</h2>
            </div>

            <div class="import-section">
              <input type="file" id="csv-file" accept=".csv" class="input" />
              <button class="btn btn--primary" id="import-btn">Importar</button>
            </div>

            <div id="import-preview" class="import-preview"></div>

            <!-- Dados de Demonstração -->
            <div class="demo-section">
              <h3>Dados de Demonstração</h3>
              <p>
                Use esta opção para criar dados de exemplo e testar o sistema:
              </p>
              <button class="btn btn--secondary" id="create-demo-btn">
                Criar Dados de Demonstração
              </button>
              <p class="text-muted">
                <small>
                  Isso criará 10 pedidos (6 PADRÃO + 4 EXPRESSO) e 1 lote de
                  demonstração.
                </small>
              </p>
            </div>

            <!-- Backup e Restauração -->
            <div class="backup-section">
              <h3>Backup e Restauração</h3>
              <p>
                Exporte seus dados para usar em outros dispositivos ou faça
                backup:
              </p>

              <div class="backup-actions">
                <button class="btn btn--primary" id="export-data-btn">
                  📤 Exportar Dados
                </button>
                <button class="btn btn--secondary" id="import-data-btn">
                  📥 Importar Dados
                </button>
                <input
                  type="file"
                  id="backup-file"
                  accept=".json"
                  class="input"
                  style="display: none"
                />
              </div>

              <div class="backup-info">
                <p class="text-muted">
                  <small>
                    <strong>Como usar:</strong><br />
                    1. Clique em "Exportar Dados" para baixar um arquivo com
                    todos os seus dados<br />
                    2. Salve o arquivo no Google Drive, Dropbox ou envie por
                    email<br />
                    3. Em outro dispositivo, clique em "Importar Dados" e
                    selecione o arquivo
                  </small>
                </p>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Modals -->
      <div id="modal-overlay" class="modal-overlay"></div>

      <!-- Batch Modal -->
      <div id="batch-modal" class="modal">
        <div class="modal__content">
          <div class="modal__header">
            <h3 id="batch-modal-title">Novo Lote</h3>
            <button
              class="modal__close"
              id="batch-modal-close"
              onclick="window.app.batch.closeModal()"
            >
              &times;
            </button>
          </div>
          <form id="batch-form" class="form">
            <div class="form__group">
              <label for="batch-name" class="form__label">Nome do Lote *</label>
              <input type="text" id="batch-name" class="form__input" required />
            </div>
            <div class="form__group">
              <label for="batch-code" class="form__label">Código do Lote</label>
              <input type="text" id="batch-code" class="form__input" readonly />
            </div>
            <div class="form__group">
              <label for="batch-tracking" class="form__label"
                >Código de Rastreio</label
              >
              <input type="text" id="batch-tracking" class="form__input" />
            </div>
            <div class="form__group">
              <label for="batch-notes" class="form__label">Notas</label>
              <textarea id="batch-notes" class="form__textarea"></textarea>
            </div>
            <div class="form__group">
              <label class="form__label">Selecionar Pedidos</label>
              <input
                type="text"
                id="order-search-modal"
                class="form__input"
                placeholder="Buscar pedidos..."
              />
              <div id="available-orders" class="orders-selector"></div>
            </div>
            <div class="form__actions">
              <button
                type="button"
                class="btn btn--secondary"
                id="batch-modal-cancel"
                onclick="window.app.batch.closeModal()"
              >
                Cancelar
              </button>
              <button
                type="button"
                class="btn btn--primary"
                id="batch-modal-save"
              >
                Salvar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Order Modal -->
      <div id="order-modal" class="modal">
        <div class="modal__content">
          <div class="modal__header">
            <h3 id="order-modal-title">Novo Pedido</h3>
            <button class="modal__close" id="order-modal-close">&times;</button>
          </div>
          <form id="order-form" class="form">
            <div class="form__group">
              <label for="order-id" class="form__label">ID do Pedido *</label>
              <input type="text" id="order-id" class="form__input" required />
            </div>
            <div class="form__group">
              <label for="order-customer" class="form__label"
                >Nome do Cliente *</label
              >
              <input
                type="text"
                id="order-customer"
                class="form__input"
                required
              />
            </div>
            <div class="form__group">
              <label for="order-product" class="form__label"
                >Nome do Produto *</label
              >
              <input
                type="text"
                id="order-product"
                class="form__input"
                required
              />
            </div>
            <div class="form__group">
              <label for="order-size" class="form__label">Tamanho</label>
              <input type="text" id="order-size" class="form__input" />
            </div>
            <div class="form__group">
              <label for="order-sku" class="form__label">SKU</label>
              <input type="text" id="order-sku" class="form__input" />
            </div>
            <div class="form__group">
              <label for="order-shipping" class="form__label"
                >Tipo de Frete *</label
              >
              <select id="order-shipping" class="form__select" required>
                <option value="PADRAO">Padrão</option>
                <option value="EXPRESSO">Expresso</option>
              </select>
            </div>
            <div class="form__group">
              <label for="order-payment" class="form__label"
                >Status do Pagamento *</label
              >
              <select id="order-payment" class="form__select" required>
                <option value="PAGO">Pago</option>
                <option value="AGUARDANDO">Aguardando</option>
                <option value="CANCELADO">Cancelado</option>
              </select>
            </div>
            <div class="form__group">
              <label for="order-notes" class="form__label">Notas</label>
              <textarea id="order-notes" class="form__textarea"></textarea>
            </div>
            <div class="form__actions">
              <button
                type="button"
                class="btn btn--secondary"
                id="order-modal-cancel"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn--primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Batch Detail Modal -->
      <div id="batch-detail-modal" class="modal modal--large">
        <div class="modal__content">
          <div class="modal__header">
            <h3 id="batch-detail-title">Detalhes do Lote</h3>
            <button
              class="modal__close"
              id="batch-detail-close"
              onclick="window.app.batch.closeModal('batch-detail-modal')"
            >
              &times;
            </button>
          </div>
          <div id="batch-detail-content" class="batch-detail">
            <!-- Content will be dynamically loaded -->
          </div>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div
      id="login-modal"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        z-index: 1001;
        min-width: 300px;
      "
    >
      <h3 style="margin: 0 0 20px 0; text-align: center">🔐 Autenticação</h3>
      <form
        id="login-form"
        onsubmit="event.preventDefault(); window.app.auth.handleLoginAttempt();"
      >
        <div style="margin-bottom: 15px">
          <label
            for="login-username"
            style="display: block; margin-bottom: 5px; font-weight: 500"
            >Usuário</label
          >
          <input
            type="text"
            id="login-username"
            style="
              width: 100%;
              padding: 10px;
              border: 1px solid #ddd;
              border-radius: 4px;
              box-sizing: border-box;
            "
            placeholder="Digite seu usuário"
            required
          />
        </div>
        <div style="margin-bottom: 15px">
          <label
            for="login-password"
            style="display: block; margin-bottom: 5px; font-weight: 500"
            >Senha</label
          >
          <input
            type="password"
            id="login-password"
            style="
              width: 100%;
              padding: 10px;
              border: 1px solid #ddd;
              border-radius: 4px;
              box-sizing: border-box;
            "
            placeholder="Digite sua senha"
            required
          />
        </div>
        <div
          id="login-error"
          style="
            color: #dc3545;
            font-size: 14px;
            margin-bottom: 15px;
            display: none;
          "
        ></div>
        <div style="display: flex; gap: 10px; justify-content: flex-end">
          <button
            type="button"
            class="btn btn--secondary"
            onclick="window.app.auth.hideLoginModal()"
          >
            Cancelar
          </button>
          <button type="submit" class="btn btn--primary">Entrar</button>
        </div>
      </form>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Vendor JS -->
    <script src="../vendor/papaparse.min.js"></script>

    <!-- App JS -->
    <script type="module" src="js/index.js?v=1.2"></script>
  </body>
</html>
